---
title: iOS和Android的蓝牙开发的区别
date: 2020-01-12 11:49:16
permalink: /pages/74d2ab3fbfeaaa68
categories:
  - 《Bluetooth 范围｜蓝牙®开发实践指北》笔记
tags:
  - JavaScript
author:
  name: Coder Bruce
  link: https://bruceyou.notion.site/Coder-Bruce-5a8c1717a6d048b9bcaadf95281f1159
---

## Android和iOS蓝牙开发的不同之处

### BLE支持程度不同

虽然Android和iOS都支持BLE，但是在早期版本中，Android的BLE支持并不完善，直到Android 4.3版本才完整支持BLE。而iOS从iOS 5开始就支持BLE。

### API不同

Android和iOS的蓝牙API不同，因此在开发过程中需要使用不同的API调用来实现相同的功能。例如，在Android中使用BluetoothAdapter类和BluetoothGatt类来实现蓝牙连接和数据传输，而在iOS中使用CBCentralManager和CBPeripheral类来实现相同的功能。

### 设备发现方式不同

在Android中，可以通过搜索附近设备的方式来发现可用的蓝牙设备，而在iOS中，需要设备先广播自己的服务和特征，然后才能被中心设备发现。

### 蓝牙配对方式不同

在Android中，可以使用PIN码或者配对码来进行蓝牙设备的配对。而在iOS中，蓝牙设备通常是不需要配对的，而是通过与中心设备建立安全连接来实现数据传输的安全性。

总之，虽然Android和iOS都支持经典蓝牙和BLE协议，但是在API、设备发现方式和蓝牙配对方式等方面有所不同，需要根据具体平台的特点进行开发。

在Android中，使用PIN码或者配对码进行配对的方式是蓝牙协议本身的一部分，Android实现了这种方式来确保蓝牙设备之间的安全连接。具体来说，当两台Android设备进行蓝牙配对时，它们会交换一个PIN码或者配对码，并使用该码来验证对方的身份，从而确保连接的安全性。

而在iOS中，蓝牙设备通常是不需要配对的，而是通过与中心设备建立安全连接来实现数据传输的安全性。这是因为iOS使用了一种叫做"Bluetooth Smart Secure Connections"的安全连接方式，该方式使用了一些先进的加密技术来确保数据传输的安全性。在这种连接方式下，蓝牙设备不需要交换PIN码或者配对码，而是直接与中心设备建立安全连接。

总之，这种区别主要是由于Android和iOS的蓝牙实现方式不同所导致的。

Bluetooth Smart Secure Connections（即Bluetooth LE Secure Connections）是一种蓝牙低功耗技术，它提供了一种安全且易于使用的方法，用于在配对过程中对连接进行加密和身份验证。它是Bluetooth 4.2规范的一部分，也是Bluetooth 5.0中的一项重要改进。

官方描述可在以下链接中找到：https://www.bluetooth.com/specifications/adopted-specifications/bluetooth-smart-technology/bluetooth-smart-secure-connections/

#### 也就是说苹果在系统层就做了安全校验这一步 Bluetooth Smart Secure Connections 是一种用于低功耗蓝牙设备的安全连接方式，它通过公钥加密算法来实现设备之间的安全通信。它的原理可以概括为以下几个步骤：

1. 设备协商密钥：在连接建立过程中，设备会使用安全协议协商出一个共享密钥。这个共享密钥将作为加密通信的密钥，保证数据的机密性和完整性。
2. 交换公钥：在密钥协商之后，设备会互相交换公钥。这个过程可以防止中间人攻击，确保通信的安全性。
3. 认证：设备之间进行相互认证，确保通信双方的身份合法，防止假冒设备的攻击。
4. 数据加密：使用协商好的密钥对通信数据进行加密，保证数据的机密性和完整性。

总之，Bluetooth Smart Secure Connections 通过公钥加密算法来保证设备之间的安全通信，防止中间人攻击和假冒设备的攻击，是低功耗蓝牙设备安全连接的本质。

#### 在 Android 中进行 PIN 码或配对码配对的操作步骤如下：

1. 打开设备蓝牙功能：在 Android 设备中打开蓝牙功能。
2. 搜索可用的设备：使用 BluetoothAdapter.startDiscovery() 方法搜索附近的蓝牙设备。
3. 发起配对请求：使用 BluetoothDevice.createBond() 方法发起与指定设备的配对请求。
4. 输入 PIN 码或配对码：在 Android 设备上输入 PIN 码或配对码，以便验证配对设备的身份。
5. 配对成功：如果输入的 PIN 码或配对码正确，配对请求就会成功，设备之间建立安全连接，可以进行数据传输了。

需要注意的是，如果设备之前已经进行过配对，那么下次连接时就不需要再输入 PIN 码或配对码，系统会自动建立安全连接。

在 Android 中进行 PIN 码或配对码配对需要以下步骤：

1. 获取 BluetoothAdapter 实例

```
javaCopy code
BluetoothAdapter bluetoothAdapter = BluetoothAdapter.getDefaultAdapter();
```

1. 打开蓝牙设备

```
javaCopy code
if (!bluetoothAdapter.isEnabled()) {
    Intent enableBtIntent = new Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE);
    startActivityForResult(enableBtIntent, REQUEST_ENABLE_BT);
}
```

1. 搜索附近的蓝牙设备并选择需要配对的设备

```
javaCopy code
Set<BluetoothDevice> pairedDevices = bluetoothAdapter.getBondedDevices();
if (pairedDevices.size() > 0) {
    for (BluetoothDevice device : pairedDevices) {
        if (device.getName().equals("需要配对的设备名称")) {
            deviceToPair = device;
            break;
        }
    }
}
```

1. 进行配对

```
javaCopy code
try {
    Method m = deviceToPair.getClass().getMethod("createBond", (Class[]) null);
    m.invoke(deviceToPair, (Object[]) null);
} catch (Exception e) {
    e.printStackTrace();
}
```

1. 输入 PIN 码或配对码进行配对

```
javaCopy code
deviceToPair.setPin(new byte[]{1,2,3,4,5,6}); // PIN 码
deviceToPair.setPairingConfirmation(true); // 配对码
```

需要注意的是，输入 PIN 码或配对码的过程需要用户手动输入，因此需要在 UI 线程中进行。此外，建议在配对完成后将配对设备的信息保存下来，以便后续连接时使用。
